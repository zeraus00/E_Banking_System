@using E_BankingSystem.Components.Client_page.Accounts

<!-- Carousel Component -->
<div class="flex-grow-1 d-flex justify-content-center container">
    <div class="carousel-wrapper px-5 py-2">

        <!-- Left Arrow -->
        <button class="carousel-arrow left" @onclick="ScrollLeft">
            <i class="bi bi-chevron-left text-light"></i>
        </button>

        <!-- The Carousel Scroll Area -->
        <div id="accountCarousel" class="carousel position-relative">
            @if (Accounts is not null && Accounts.Any())
            {
                foreach (var account in Accounts)
                {
                    <AccountCard LinkedAccount="account" ContactNumber="@(account?.AccountContactNo ?? "09123456789")" IsEditable="IsEditable" />
                }
            }
        </div>

        <!-- Right Arrow -->
        <button class="carousel-arrow right" @onclick="ScrollRight">
            <i class="bi bi-chevron-right text-light"></i>
        </button>

        <!-- Pagination Dots -->
        <div class="carousel-pagination d-flex justify-content-center mt-3">
            @for (int i = 0; i < Accounts!.Count; i++)
            {
                <button class="dot mx-1 @(activeIndex == i ? "active" : "")" @onclick="@(() => ScrollToCard(i))"></button>
            }
        </div>
    </div>

</div>


<!-- JavaScript (Carousel Horizontal Scroll) -->
<script>
    function scrollCarousel(direction) {
    const carousel = document.getElementById('accountCarousel');
    const scrollAmount = 300;

    if (direction === 'left') {
    carousel.scrollBy({ left: -scrollAmount, behavior: 'smooth'});
    } else if (direction === 'right') {
    carousel.scrollBy({ left: scrollAmount, behavior: 'smooth'});
    }
    }

    function scrollToCard(index) {
    const carousel = document.getElementById('accountCarousel');
    const cards = carousel.querySelectorAll('.carousel-card');

    if (cards.length === 0 || !cards[index]) return;

    const card = cards[index];
    const carouselLeft = carousel.getBoundingClientRect().left;
    const cardLeft = card.getBoundingClientRect().left;

    const scrollLeft = carousel.scrollLeft;
    const offset = cardLeft - carouselLeft;

    carousel.scrollTo({
    left: scrollLeft + offset,
    behavior: 'smooth'
    });
    }
</script>

@code {
    private int activeIndex = 0;

    [Parameter]
    public List<LinkedAccount> Accounts { get; set; } = new();

    [Parameter]
    public UserInfo? UserInfo { get; set; }

    [Parameter]
    public bool IsEditable { get; set; } = false;

    private async Task ScrollLeft()
    {
        if (Accounts.Count == 0) return;

        activeIndex = (activeIndex - 1 + Accounts.Count) % Accounts.Count; 
        await JS.InvokeVoidAsync("scrollToCard", activeIndex);
    }

    private async Task ScrollRight()
    {
        if (Accounts.Count == 0) return;

        activeIndex = (activeIndex + 1) % Accounts.Count;
        await JS.InvokeVoidAsync("scrollToCard", activeIndex);
    }

    private async Task ScrollToCard(int index)
    {
        activeIndex = index; 
        await JS.InvokeVoidAsync("scrollToCard", index); 
    }


    [Inject]
    private IJSRuntime JS { get; set; } = default!;
}